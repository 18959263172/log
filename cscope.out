cscope 16 d:\myproject\log"               0000002791
	@logger.c

5 
	~"logg”.h
"

7 #ifdeà
WIN32


8 
CRITICAL_SECTION
 
	gg_cs
;

12 
logfe
 
	grou‹s
;

14 
	$İ’_log
(*
buf
)

16 if(
rou‹s
.
fe
=
	`fİ’
(
buf
,"a+"))

22 
	`´štf
("error open file \r\n");

25 
	}
}

27 
	$wr™e_log
()

29 if(
rou‹s
.
void_æag
)

35 if(
	`åuts
(
rou‹s
.
que
[
i_pos_p
].
log
,rou‹s.
fe
)==0)

38 #ifdeà
WIN32


39 
	`EÁ”Cr™iÿlSeùiÚ
(&
g_cs
);

41 
i_pos_p
++;

43 if(
i_pos_p
==
rou‹s
.
i_pos
+1)

45 
rou‹s
.
i_pos
=0;

46 
rou‹s
.
i_pos_p
=0;

49 
rou‹s
.
void_æag
=1;

50 
	`L—veCr™iÿlSeùiÚ
(&
g_cs
);

55 #ifdeà
_LINUX


61 
	}
}

63 
	$ş—n_log
Ğ* 
buf
)

65 if(!
	`»move
(
buf
))

68 
	}
}

70 #ifdeà
WIN32


74 
HANDLE
 
	ghªdË
;

76 
CALLBACK
 
	$Tim”Proc
(
HWND
 
hwnd
,
UINT
 
uMsg
,UINT 
idEv’t
,
DWORD
 
dwTime
)

78 if(
	`wr™e_log
())

80 #ià
DEBUG


81 
	`´štf
("open data ok! \r\n");

86 #ià
DEBUG


87 
	`´štf
("write dataƒrror \r\n");

91 
	}
}

94 #iâdeà
__AFX_H__


95 
DWORD
 
WINAPI
 
	$Fun
(
LPVOID
 
ÍP¬am‹r
)

97 
BOOL
 
bR‘
;

98 
MSG
 
msg
;

99 
x
;

100 
tim”id
 = 
	`S‘Tim”
(
NULL
,111,3000,
Tim”Proc
);

101 if(
rou‹s
.
äeq_ms
>0)

103 if(
	`S‘Tim”
(
NULL
,10,
rou‹s
.
äeq_ms
,&
Tim”Proc
))

104 
x
=-1;

106 
	`P“kMes§ge
(&
msg
,
NULL
,
WM_USER
,WM_USER,
PM_NOREMOVE
);

107 (
bR‘
 = 
	`G‘Mes§ge
(&
msg
,
NULL
,0,0))!=0)

109 ià(
bR‘
 == -1)

111 
	`´štf
("E¼Ü:thth»ad wÈqu™,”rÜ id i %d/n",
	`G‘La¡E¼Ü
());

116 
	`T¿n¦©eMes§ge
(&
msg
);

117 
	`Di¥©chMes§ge
(&
msg
);

120 
	`KlTim”
(
NULL
,
tim”id
);

121 
	`´štf
("threadƒnd here/n");

123 
	}
}

132 
	$¡¬t_log
()

134 #ifdeà
WIN32


136 
rou‹s
.
que
=(
log¡r
*)
	`m®loc
((log¡r)*
MAX_NUM
);

138 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
g_cs
);

140 
hªdË
 = 
	`C»©eTh»ad
(
NULL
, 0, 
Fun
, NULL, 0, NULL);

142 
	`Wa™FÜSšgËObjeù
(
hªdË
, 
INFINITE
);

148 
	}
}

151 
	$¡İ_log
()

153 
	`Clo£HªdË
(
hªdË
);

154 
	}
}

156 
	$queue_š
(*
c_¡r
)

158 #ifdeà
WIN32


159 
	`EÁ”Cr™iÿlSeùiÚ
(&
g_cs
);

161 
	`memıy
(
rou‹s
.
que
[
i_pos
].
log
,
¡r
,
	`¡¾’
(
c_¡r
));

163 
rou‹s
.
que
[
i_pos


164 ].
n
=
	`¡¾’
(
c_¡r
);

166 
rou‹s
.
i_pos
++;

168 
	`L—veCr™iÿlSeùiÚ
(&
g_cs
);

171 
	}
}

	@logger.h

1 #iâdeà
__LOG__


2 
	#__LOG__


	)

4 
	~<m®loc.h
>

5 
	~<¡dio.h
>

7 #ifdeà
WIN32


9 
	~<wšdows.h
>

11 
	~<wšu£r.h
>

15 
	#DEBUG
 1

	)

17 #ifdeà
_LINUX


20 
	~<±h»ad.h
>

24 
	#MAX_NUM
 100

	)

27 
	slog¡r


29 
log¡r
 *
	mÃxt
;

30 *
	mlog
;

31 
	mn
;

34 
	slog_š‹rçû


36 
	mlog_num
;

37 
log¡r
 *
	mque
;

38 
	mvoid_æag
;

39 
FILE
* 
	mfe
;

40 
	mäeq_ms
;

41 
	mi_pos
;

42 
	mi_pos_p
;

45 
log_š‹rçû
 
	tlogfe
;

47 
İ’_log
Ğ*
·th
);

49 
wr™e_log
();

51 
¡¬t_log
();

53 
ş—n_log
Ğ*
·th
);

55 
¡İ_log
();

57 
queue_š
(*
buf
);

59 
logfe
 
rou‹s
;

	@
1
.
0
2
18
logger.c
logger.h
